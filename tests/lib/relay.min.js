function RelayObject(a){this.id=a.id;this.parent=a.parent}RelayObject.prototype.findFirstParent=function(a){if(!a)return element.parent;for(var b=this.parent;null!=b&&!a(b);)b=b.parent;return b};RelayObject.prototype.typeString=function(){if(this&&this.constructor&&this.constructor.toString){var a=this.constructor.toString().match(/function\s*(\w+)/);if(a&&2==a.length)return a[1]}};__relay_extend__(RelayObject,Describe);function Describe(a){RelayObject.call(this,a);this.name=a.name;this.func=a.func;this.children=[];this.befores=a.befores?a.befores:[];this.afters=a.afters?a.afters:[]}Describe.prototype.perform=function(a){var b=this;this.func();__relay_loop__(0,this.children.length,function(a,e){__relay_enter__(b.children[a],e)},a)};__relay_extend__(RelayObject,Expect);function Expect(a){RelayObject.call(this,a);this.success=!1;this.value=a.value;this.expectedValue=null;this.comparisonType="";this.caller=a.caller;a.value&&(this.success=!0)}Expect.prototype.perform=function(a){a()};Expect.prototype.toMatch=function(a){this.expectedValue=a;this.success=(a=this.value.match(RegExp(a)))&&0<a.length;this.comparisonType="match"};Expect.prototype.toBe=function(a){this.expectedValue=a;this.success=this.value===a;this.comparisonType="be"};
function isArray(a){return"[object Array]"===Object.prototype.toString.apply(a)}function isObject(a){return"object"==typeof a}function isEqual(a,b){if(!a&&b||a&&!b)return!1;if(a==b)return!0;if(isArray(a)){if(isArray(b)){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0}return!1}if(isObject(a)){if(!isObject(b))return!1;var c=0,e;for(e in b)c++;var d=0;for(e in a)if(d++,void 0==b[e]||!isEqual(a[e],b[e]))return!1;return c!=d?!1:!0}return a==b}
Expect.prototype.toEqual=function(a){this.expectedValue=a;this.success=isEqual(this.value,a);this.comparisonType="equal"};Expect.prototype.toNotEqual=function(a){this.expectedValue=a;this.success=!isEqual(this.value,a);this.comparisonType="not equal"};Expect.prototype.toBeUndefined=function(){this.success=void 0==this.val;this.comparisonType="undefined"};Expect.prototype.toBeNull=function(){this.success=null==this.val;this.comparisonType="null"};
Expect.prototype.resultString=function(){var a="expected "+JSON.stringify(this.value);"match"==this.comparisonType?a+=" to match "+JSON.stringify(this.expectedValue):"be"==this.comparisonType?a+=" to be "+JSON.stringify(this.expectedValue):"equal"==this.comparisonType?a+=" to equal "+JSON.stringify(this.expectedValue):"undefined"==this.comparisonType?a+=" to be undefined":"null"==this.comparisonType&&(a+=" to be null");return a};__relay_extend__(RelayObject,It);function It(a){RelayObject.call(this,a);this.name=a.name;this.func=a.func;this.children=[];this.expects=[];this.befores=a.befores?a.befores:[];this.afters=a.afters?a.afters:[]}
It.prototype.perform=function(a){function b(){d.func();__relay_loop__(0,d.children.length,function(a,b){__relay_enter__(d.children[a],b)},c)}function c(){__relay_loop__(0,d.expects.length,function(a,b){__relay_enter__(d.expects[a],b)},e)}function e(){d.afters?__relay_loop__(0,d.afters.length,function(a,b){__relay_enter__(d.afters[a],b)},a):a()}var d=this;d.befores?__relay_loop__(0,d.befores.length,function(a,b){__relay_enter__(d.befores[a],b)},b):b()};var RelayListener=function(){};RelayListener.prototype={onRelayStart:function(){},onRelayEnd:function(){},onEnter:function(){},onExit:function(){}};var __relay_singleton__=null;
function relay(){if(null!=__relay_singleton__)return __relay_singleton__;__relay_singleton__={listeners:[],relayStack:[],idCounter:0};var a=new Describe({id:__relay_singleton__.idCounter++,parent:null});__relay_singleton__.relayStack.push(a);__relay_singleton__.start=function(){__relay_broadcast__("onRelayStart");__relay_loop__(0,a.children.length,function(b,c){__relay_enter__(a.children[b],c)},function(){__relay_broadcast__("onRelayEnd")})};return __relay_singleton__}
function describe(a,b){__relay_stack_peek__().children.push(new Describe({id:__relay_next_id__(),parent:__relay_stack_peek__(),name:a,func:b,befores:__relay_stack_peek__().befores.slice(0),afters:__relay_stack_peek__().afters.slice(0)}))}function beforeEach(a){__relay_stack_peek__().befores.push(new Run({id:__relay_next_id__(),parent:__relay_stack_peek__(),func:a}))}function afterEach(a){__relay_stack_peek__().afters.push(new Run({id:__relay_next_id__(),parent:__relay_stack_peek__(),func:a}))}
function it(a,b){__relay_stack_peek__().children.push(new It({id:__relay_next_id__(),parent:__relay_stack_peek__(),name:a,func:b,befores:__relay_stack_peek__().befores.slice(0),afters:__relay_stack_peek__().afters.slice(0)}))}function runs(a){__relay_stack_peek__().children.push(new Run({id:__relay_next_id__(),parent:__relay_stack_peek__(),name:name,func:a,befores:__relay_stack_peek__().befores.slice(0),afters:__relay_stack_peek__().afters.slice(0)}))}
function expect(a){a=new Expect({id:__relay_next_id__(),parent:__relay_stack_peek__(),value:a,caller:__relay_caller__()});__relay_stack_peek__().expects.push(a);return a}function addRelayListener(a){relay().listeners.push(a)}function __relay_extend__(a,b){function c(){}c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b}function __relay_stack_peek__(){var a=relay();return a.relayStack[a.relayStack.length-1]}function __relay_next_id__(){return relay().idCounter++}
function __relay_enter__(a,b){__relay_broadcast__("onEnter",a);relay().relayStack.push(a);a.perform(function(){__relay_exit__(b)})}function __relay_exit__(a){var b=relay().relayStack.pop();__relay_broadcast__("onExit",b);a()}function __relay_loop__(a,b,c,e){if(a<b)c(a,function(){__relay_loop__(a+1,b,c,e)});else return e()}
function __relay_caller__(){function a(a){return{"&":"&amp;","<":"&lt;",">":"&gt;"}[a]||a}try{throw Error("");}catch(b){for(var c=null,e=b.stack.split("\n"),d=0;d<e.length;d++){var f=/[^\(]*\(([^\)]*)\)/ig.exec(e[d]);if(f&&2<=f.length&&(f=/specs\/(.*)$/ig.exec(f[1]))&&2<=f.length){c=f[1].replace(/[&<>]/g,a);break}}return c}}function __relay_broadcast__(a,b){for(var c=0;c<relay().listeners.length;c++)relay().listeners[c][a](b)};__relay_extend__(RelayObject,Run);function Run(a){RelayObject.call(this,a);this.func=a.func;this.expects=[];a.befores&&(this.befores=a.befores);a.afters&&(this.afters=a.afters)}Run.prototype.perform=function(a){var b=this;b.func(function(){__relay_loop__(0,b.expects.length,function(a,e){__relay_enter__(b.expects[a],e)},function(){a()})})};
